<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/nxrefine/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>NxRefine - CHESS ID4B QM2</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "NxRefine";
        var mkdocs_page_input_path = "nxrefine.md";
        var mkdocs_page_url = "/nxrefine/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-ABC123"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', "G-ABC123");
      </script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CHESS ID4B QM2
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="..">Welcome</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Beamline information</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../introduction/">Introduction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../publications/">Beamline Publications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beamline_parameters/">Beamline USER Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Sample information</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../sample_env/">Sample environment</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../sample/">Sample mount</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../SPEC_commands/">ID4B-SPEC commands</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../beamline_basics/">Beamline basics</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Sample alignment</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../sample_alignment_HDRM/">HDRM</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../sample_alignment_REXS/">REXS</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../temp/">Temperature switch</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../gas_flow/">Gas flow control</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Data Analysis</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../ID4B_Codes/">Data processing</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../ID4B_Codes_general_nodes/">General node</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../nxrefine_General_Node/">NxRefine General Node</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">NxRefine</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../detailed_dataanalysis/">Detailed Data Analyis</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../practice_notebook/">Practice Analysis Notebook</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Google Colab - Practice Notebook </a>
    <ul>
                <li class="toctree-l3"><a class="" href="https://colab.research.google.com/drive/13pxbP-x5YinKdkWpURBmMKRLp9SQCtqr?authuser=4#scrollTo=shP_EDON253l">Loading data (Colab)</a>
                </li>
                <li class="toctree-l3"><a class="" href="https://colab.research.google.com/drive/1r1q5RReKN0aZyvmIvYZd-USKgWktEUBZ?authuser=4#scrollTo=eed93954-2c1b-446c-a69f-23572e6f2090">Temp Analysis (Colab)</a>
                </li>
                <li class="toctree-l3"><a class="" href="https://colab.research.google.com/drive/1HOgyH6LStXpYk2xE8yPmo8e4mL1lCqPX?authuser=4">Orthogonal cut (colab)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Data visualization</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../nexpy/">NeXpy</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../pymca/">pyMCA</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Beamline equipments</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../PTZ_camera/">Cameras</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../diffractometer/">Diffractometer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../cryocooler/">Cryocooler</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../detector_information/">Detector</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Things to check during beamtime</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../note/">Note</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Troubleshooting</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../IC1_signal/">IC1 signal issues</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../controlC_question/">Control C Questions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../beam_dump/">Beam dump</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lost_fourc/">Missing SPEC</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../camera_image_stuck/">Camera image stuck</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../nexpy_crushed/">NexPy crushed</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lower_diode_signal/">Lower diode signal</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cryo_fail/">Cryostream sudden failure</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../comp_issues/">Computer Issues</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Admin Documentation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../beamline_setup/">Beamline setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../Cryostat/">Cryostat</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../energy_change/">Energy change</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SPEC_macros/">SPEC macro</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Frequently Asked Questions (FAQ)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../information/">Before coming to the beamline</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../FAQ/">Beamline Frequently Asked Questions</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">About</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../about/">About</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../license/">License</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CHESS ID4B QM2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Home</li>
          <li class="breadcrumb-item">Beamline information</li>
          <li class="breadcrumb-item">Data Analysis</li>
      <li class="breadcrumb-item active">NxRefine</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/suchismitasarker/CHESS-ID4B-QM2/blob/main/README.md/edit/master/docs/nxrefine.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div><h1 id="nxrefine">NXRefine<a class="headerlink" href="#nxrefine" title="Permanent link">¶</a></h1>
<p>The code is written by Dr. Ray Osborn. More details will be available <a href="https://nexpy.github.io/nxrefine/">NXRefine</a>.The code provides various tools for stacking the raw data, finding Bragg peaks, solving the orientation matrix, and finally providing the HKL. </p>
<h1 id="data-policy">Data Policy<a class="headerlink" href="#data-policy" title="Permanent link">¶</a></h1>
<div class="admonition hint">
<p class="admonition-title">Data policy</p>
<p>We only stored the raw data for six months and processed data for a year. Please process the data and copy it to your server. If you need more time, then consult your beamline scientist.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">CHESS data processing steps</p>
</div>
<h3 id="steps-to-use-the-nxrefine-gui-at-chess-data-analysis-computer">Steps to use the NXRefine GUI at CHESS data analysis computer<a class="headerlink" href="#steps-to-use-the-nxrefine-gui-at-chess-data-analysis-computer" title="Permanent link">¶</a></h3>
<ul>
<li>
<p><i> Step 0 </i>: Create the nxrefine folder with correct calibration file 
      Talk to beamline scientist if you have any questions)</p>
</li>
<li>
<p><i> Step 1 </i>: Link raw data to process data folder</p>
<div class="codehilite"><pre><span></span><code>    Import and link the data from id4b to id4baux folder
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/IAX8-wOgImc?si=CdC_gDJQmBnrNGEq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 2 </i>: Check data and manage workflow<div class="codehilite"><pre><span></span><code>    Load the data from the GUI
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/9Js5P2Gn_nk?si=7tnBI5l4xqypNcmh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 3 </i>: Find peaks and max peak values<div class="codehilite"><pre><span></span><code>    DONOT submit job link, max, find together, run it one by one, otherwise, program will break
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/3bl7pVS2CWI?si=Zdvoku9h_T1JQkfG" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 4 </i>: Finding orientation matrix<div class="codehilite"><pre><span></span><code>    If you are not able to do that, talk to beamline scientist
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/AKL9SOP9clQ?si=BmiP6PhG6uTt3T8u" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 5 </i>: Check HKLI <div class="codehilite"><pre><span></span><code>    Check the data
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/qbSChMwf0Ck?si=4oNTPcOg9_gqFA2p" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 6 </i>: Check data : HKLI Volume</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/5_G1QN8JlMw?si=CckLYZPVJmbeBffS" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 7 </i>: Parent file selection for processing different temperatures datasets<div class="codehilite"><pre><span></span><code>    * Check the data
    * Make sure data looks good 
    * Select the file as the parent file
</code></pre></div>

</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/dCsU3QN5yQ0?si=56-IMaUNto7gdNBh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<ul>
<li><i> Step 8 </i>: Check the viewing server log</li>
</ul>
<iframe width="600" height="315" src="https://www.youtube.com/embed/EwwbVRqq308?si=u0m6DHsAH_AgnnOb" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>=================================================================</p>
<h2 id="running-jobs-from-the-terminal-in-general-node-during-beamtime">Running jobs from the terminal in general node, during beamtime<a class="headerlink" href="#running-jobs-from-the-terminal-in-general-node-during-beamtime" title="Permanent link">¶</a></h2>
<div class="admonition hint">
<p class="admonition-title">During beamtime nxrefine </p>
<p>Steps for Data Analysis (during beamtime) </p>
<div class="codehilite"><pre><span></span><code>    Step 1: Open your terminal:
    ssh &lt;chess_id&gt;@lnx201.classe.cornell.edu

    Step 2: In the beamline data analysis GUI nxrefine
    Import the data: https://www.youtube.com/watch?v=IAX8-wOgImc

    Step 3: Beamline file qsub file change: 
          cd /nfs/chess/id4baux/2025-2/&lt;proposal_id&gt;/scripts/

    Step 4: Change the permission in beamline data analysis computer and your own computer
          chmod -R 777 /nfs/chess/id4baux/&lt;cycle_number&gt;/&lt;proposal_id&gt;

    Step 5: Modify the qsub script in the folder (below is the details)

    Step 4: Change the permission again in beamline data analysis computer and your own computer
           chmod -R 777 /nfs/chess/id4baux/&lt;cycle_number&gt;/&lt;proposal_id&gt;

    Step 6: Submit the job from your own terminal

          qsub -q all.q -l mem_free=200G -pe sge_pe 16 /nfs/chess/id4baux/2025-1/&lt;proposal_id&gt;/qsub_116.sh
</code></pre></div>

</div>
<h5 id="step-5-details-how-to-change-scripts">Step 5 Details: How to change scripts:<a class="headerlink" href="#step-5-details-how-to-change-scripts" title="Permanent link">¶</a></h5>
<ul>
<li>Rename the file name of the script with temperature</li>
<li>Change the directory and temperature of the folder<div class="codehilite"><pre><span></span><code>          Step 1: USER_DIR='/nfs/chess/id4baux/2026-1/sarker-0000-a/nxrefine/FeNiCo/S1/'
          Step 2: for TEMP in 20;
</code></pre></div>

</li>
</ul>
<h3 id="option-1-parent-file-not-available">Option 1 : Parent file NOT available<a class="headerlink" href="#option-1-parent-file-not-available" title="Permanent link">¶</a></h3>
<ul>
<li>
<p>If the parent file is not avilable when you submit the jobs, run only below commands and Comment out other commands</p>
<div class="codehilite"><pre><span></span><code>    nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --load --overwrite
    nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --link --max 
    nxfind --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 -t 10000 --overwrite
</code></pre></div>

</li>
<li>
<p>Comment out other commands when parent file is not avilable</p>
<div class="codehilite"><pre><span></span><code>    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --link --copy --max
    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --copy
    # nxreduce --directory ${USER_DIR}${TEMP}  --entries f1 f2 f3 --refine
    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --transform --combine --regular
    # nxreduce --directory $USER_DIR$TEMP --pdf --regular
</code></pre></div>

</li>
<li>
<p>After the parent file is ready, make sure all the previous jobs (load, link, max, find) are completed for one particular temperature, modify the same file and run below commands and comment out below commands</p>
<div class="codehilite"><pre><span></span><code>    nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --copy
    nxreduce --directory ${USER_DIR}${TEMP}  --entries f1 f2 f3 --refine
    nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --transform --combine --regular
</code></pre></div>

</li>
<li>
<p>Comment out other commands as you already ran that</p>
<div class="codehilite"><pre><span></span><code>    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --load --overwrite
    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --link --max 
    # nxfind --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 -t 10000 --overwrite
</code></pre></div>

</li>
</ul>
<h3 id="option-2-parent-file-available">Option 2: Parent file available<a class="headerlink" href="#option-2-parent-file-available" title="Permanent link">¶</a></h3>
<p>If the parent file is avilable when you submit the jobs, run only below commands and Comment out other commands</p>
<div class="codehilite"><pre><span></span><code>        nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --load --overwrite
        nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --link --copy --max
        nxfind --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 -t 10000 --overwrite
        nxreduce --directory ${USER_DIR}${TEMP}  --entries f1 f2 f3 --refine
        nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --transform --combine --regular
</code></pre></div>

<ul>
<li>Comment out other commands (those are for option 1 only)<div class="codehilite"><pre><span></span><code>    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --link --max   
    # nxreduce --directory ${USER_DIR}${TEMP} --entries f1 f2 f3 --copy
</code></pre></div>

</li>
</ul></div></html>

              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../nxrefine_General_Node/" class="btn btn-neutral float-left" title="NxRefine General Node"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../detailed_dataanalysis/" class="btn btn-neutral float-right" title="Detailed Data Analyis">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>© Copyright 2026, CHESS ID4B Beamline</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/suchismitasarker/CHESS-ID4B-QM2/blob/main/README.md" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../nxrefine_General_Node/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../detailed_dataanalysis/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
